---
title: "Update on Bimodality Figures & Analyses"
author: "Kelly Heilman"
date: "January 10, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Biome theory overview:
Conceptually, biome thoery suggests that there is a predictible relationship between the global distribution of vegetation and environmental drivers. This hypothesized link between vegetation and its environment is the basis for simple ecosystem and dynamic vegetation models, which we often use to make predictions for a future under a changing climate and higher CO~2~. However, biomes with alternative states have two very different vegetation types that can occur within the same climate and environmental space. Thus, in biomes/regions with alternative stable states, vegetation is not a direct function of the environmet, make predictions into the future uncertain.  

Savannas in biome theory:
Biomes that can switch between Savanna and forest systems are an example of alternative states that are not directly predictable from climate and environental factors. In large areas of the tropics climate and edaphic factors are uninformative in predicting distribution of tree cover, but tree cover may be a result of disturbance-vegetation feedbacks. Fire is linked to open savanna regions within intermediate climates, where high grassy fuel loads promote fire spread. However at these same climates, closed forests may be present but light limition in the understory prevents fuel buildup, suppressing the likelihood of fire. The association of open savannas regions with high fire frequencies suggest that disturbance-vegetation feedbacks play a role in maintaining savanna & forest as alternative stable states (Staver et al.). The existence of alternative states is demonstrated by a bimodal distribution in tree density that is not well predicted by climate, but could be attributed to endogenous feedbacks.

Savanna and forest alternative states have been well documented in the tropics(Staver et al. 2011, Hoffmann et al. 2012, Dantas 2016), but have not been well documented elsewhere on the landscape. While the Upper Midwest in North American is largely forested or agricultural land use today, historical vegetation surveys documented open savanna regions in the region before the time of European settlement (Grimm 1984, Danz et al. 2011, Goring et al. 2016). Several alternative hypotheses for the existance of open savanna ecosystems in the mesic/temperate midwest have been proposed: 
  *Moisture gradient limits tree growth
  *soil drainage can limit tree growth
  *Higher Temperatures create drought conditions
  *seasonality of temperature
  *seasonality of precipitaiton
  *slope/elevation (firebreaks and soil moisture)
  *VPD 
  
In this paper, we hypothesize that the distribution of vegetation in the past is bimodal with respect to climate, and that the commonly cited hypothesized drivers do not predict the distribution of vegetation in the past. 



##Key questions we aim to answer in this analysis:
1. Was the N.American pre-euro settlement tree cover/tree density bimodal? Is the modern landscape bimodal?
2. Does climate explain the distribution of tree density in either the past or the modern landscape?
3. Do soil factors/elevation explain tree denisity in either the past or the modern landscape?
4. What is the climate/soil/environmental space where the past had alternative stable density states? How bimodal is the distribution? Where is this located within the N. American Midwest?
5. Based on this climate/soil/environmental space, where should this bimodality be observed? (acknowledging that climate has changed over the last century)

We use the density data from the places where we have both Public Land Survey data (past), and Forest Inventory Analysis data (modern) across the upper midwest:

![](outputs/v1.6/tree_density_maps_PLS_FIA.png)

#### 1. Was the N.American pre-euro settlement tree cover/tree density bimodal? Is the modern landscape bimodal?

A. Public land survey tree density is bimodal and FIA tree density is not:

![](outputs/FIA_PLS_hists.png) 

Additionally, places that historically had low tree density in the past now have higher tree density, while those that were dense in the past have decreased in tree density:


![](outputs/v1.6/density_difference_plot.png)


#### 2. Does climate explain the distribution of tree density in either the past or the modern landscape?

The past and modern climate space of the Midwest is broad spans a large range of precipitation and temperature. 

![](outputs/v1.6/precip_vs_temp_FIA_PLS.png)

PLS & FIA tree density are not readily explained by the gradient in Precipitation, but tree denisty bimodality appears to occur between 600-900 mm/year in the past. 

![](outputs/FIA_PLS_hexbinplots.png) 

PLS & FIA density are not obviously explained as a function of mean annual temperature, but the bimodality in tree density appears to occur between 0-10 DegC in the past:

![](outputs/FIA_PLS_temp_hexbinplots.png)




###3. Do soil factors/elevation explain tree denisity in either the past or the modern landscape?

A. % Sand, Available Water Content (awc), and saturated hydraulic conductivity (ksat) do not explain tree density well. 


![](outputs/v1.6/sand_vs_dens_FIA_PLS.png)
![](outputs/v1.6/awc_vs_dens_FIA_PLS.png)
![](outputs/v1.6/ksat_vs_dens_FIA_PLS.png)


###4. What is the environmental space where the past was bimodal? How bimodal is the distribution? Where is this located within the N. American Midwest?

A. To answer this, we have to define a bimodality index. There are a few options for this:
  + Dip Test (null = unimodal distribution)
  + Bimodality Coefficient calculated from size, skewness, and kurtosis of the distributions, though there may be issues with both BC and the Dip test (Pfister et al. 2013)
  + BC > 0.556 suggests bimodality
  + BC is calculated with be calculated in the R package modes
  
BC = $\frac{(skew^2 + 1)}{(kurtosis + 3)*\frac{(n-1)^2}{(n-2)*(n-3)}}$


### We can look at bins of precipitation to get an idea of where this bimodality coefficient is likely to be highest:

![](outputs/v1.6/precipitation_by_bins_100.png)

### We can look at the bins of temperature to get an idea of where the BC is likely to be highest:
![](outputs/v1.6/tmean_by_bins.png)

####Notably, looking at different binwidths of mean annual precipitation gives us a slightly different answer for the index of bimodality at each precipitation range:

####Bin range of 100, non-overlapping bins:
![](outputs/v1.6/bimodality_coefficient_full_pls_100bins.png) 

####Bin range of 75, non-overlapping bins:
![](outputs/v1.6/bimodality_coefficient_full_pls_75bins.png) 

####Bin range of 25, non-overlapping bins:
![](outputs/v1.6/bimodality_coefficient_full_pls_25bins.png) 

#### Additionally, we can have overlapping bins, where each new "bin of precpitation" is offset by 10mm/year, which also present a slightly different picture.
####Bin range of 100, overlapping bins:
![](outputs/v1.6/rolling_BC_plots_100.png)
####Bin range of 75, overlapping bins:
![](outputs/v1.6/rolling_BC_plots_75.png)
##Bin range of 25, overlapping bins:
![](outputs/v1.6/rolling_BC_plots_25.png)


####we can do the same for FIA plots & cover (not shown here)

### Figure 3: Plot of Bimodality index vs. Density (not sure how to do this, since a high BC inherently means that we have both high and low densities)

### Figure 4:
We can make maps of the precipitation climate space where BC > 5.5 from the BC values of non-overlapping bins of width = 75mm in Figure 2:

#### Map of bimodality for PLS:
![](outputs/v1.6/PLS_BC_map_75.png)

### Map of bimodality for FIA:
![](outputs/v1.6/FIA_BC_map_75.png)

### The map for PLS density bimodality does roughly match with the Map of bimodality for PLS % cover estimates (which makes sense)
![](outputs/v1.6/PLS_BC_cover_map75.png)

```{r, echo = FALSE}

#library(ggplot2)
#library(reshape2)
#library(dplyr)
#library(maps)
#library(maptools)
#library(modes)
library(stargazer)
library(mgcv)
dens.pr <- read.csv("outputs/v1.6/dens.pr.csv")



PLS.gam1 <- gam(dens.pr$PLSdensity ~ dens.pr$MAP1910 , method = "ML")
#summary(PLS.gam1) #explains 0.004% deviance


PLS.gam2 <- gam(PLSdensity ~ pasttmean , method = "ML", data = dens.pr)
#summary(PLS.gam2) #explains 15.8% deviance

PLS.gam3 <- gam(dens.pr$PLSdensity ~ dens.pr$pastdeltaP , method = "ML")
#summary(PLS.gam3) #explains 3.02% deviance

PLS.gam3 <- gam(dens.pr$PLSdensity ~ dens.pr$awc , method = "ML")
#summary(PLS.gam3) #explains 12.5% of deviance


PLS.gam4 <- gam(PLSdensity ~ pasttmean + pastdeltaP , method = "ML", data = dens.pr)
#summary(PLS.gam4) #explains 35% deviance

PLS.gam5 <- gam(dens.pr$PLSdensity ~ dens.pr$awc +dens.pr$sandpct , method = "ML")
#summary(PLS.gam5) #explains 14.9% of deviance

PLS.gam6 <- gam(dens.pr$PLSdensity ~ dens.pr$MAP1910 +dens.pr$pasttmean+ dens.pr$sandpct, method = "ML")
#summary(PLS.gam6) #explains 39% deviance

PLS.gam7 <- gam(dens.pr$PLSdensity ~ dens.pr$MAP1910 +dens.pr$pasttmean +dens.pr$awc , method = "ML")
#summary(PLS.gam7) #explains 41.3% of deviance

PLS.gam8 <- gam(dens.pr$PLSdensity ~ dens.pr$MAP1910  +dens.pr$pasttmean +dens.pr$sandpct + dens.pr$awc, method = "ML")
#summary(PLS.gam8) # explains 41% of deviance



```

## Results from Generalized additive models of PLS density with covariates:

```{r, echo = FALSE, results = 'asis'}

stargazer(PLS.gam1,PLS.gam2, PLS.gam3, PLS.gam4, PLS.gam5, PLS.gam6, PLS.gam7, PLS.gam8, type="html",
          title            = "GAM model results",dep.var.labels.include = FALSE,
          covariate.labels = c("Mean Annual Precipitation (mm)", "Mean Temperature (DegF)", "Mean Temperature (DegF)", "AWC", "Precipitaiton seasonality","% sand"),
          dep.var.caption  = "Pre-settlement tree density",
          dep.var.labels   = "Tree density (trees/ha)")


```

