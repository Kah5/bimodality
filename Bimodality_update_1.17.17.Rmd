---
title: "Update on Bimodality Figures & Analyses"
author: "Kelly Heilman"
date: "January 10, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Biome theory overview:
Conceptually, biome thoery suggests that there is a predictible relationship between the global distribution of vegetation and environmental drivers. This hypothesized link between vegetation and its environment is the basis for simple ecosystem and dynamic vegetation models, which we often use to make predictions for a future under a changing climate and higher CO~2~. However, biomes with alternative states have two very different vegetation types that can occur within the same climate and environmental space. Thus, in biomes/regions with alternative stable states, vegetation is not a direct function of the environmet, make predictions into the future uncertain.  

Savannas in biome theory:
Biomes that can switch between Savanna and forest systems are an example of alternative states that are not directly predictable from climate and environental factors. In large areas of the tropics climate and edaphic factors are uninformative in predicting distribution of tree cover, but tree cover may be a result of disturbance-vegetation feedbacks. Fire is linked to open savanna regions within intermediate climates, where high grassy fuel loads promote fire spread. However at these same climates, closed forests may be present but light limition in the understory prevents fuel buildup, suppressing the likelihood of fire. The association of open savannas regions with high fire frequencies suggest that disturbance-vegetation feedbacks play a role in maintaining savanna & forest as alternative stable states (Staver et al.). The existence of alternative states is demonstrated by a bimodal distribution in tree density that is not well predicted by climate, but could be attributed to endogenous feedbacks.

Savanna and forest alternative states have been well documented in the tropics(Staver et al. 2011, Hoffmann et al. 2012, Dantas 2016), but have not been well documented elsewhere on the landscape. While the Upper Midwest in North American is largely forested or agricultural land use today, historical vegetation surveys documented open savanna regions in the region before the time of European settlement (Grimm 1984, Danz et al. 2011, Goring et al. 2016). Several alternative hypotheses for the existance of open savanna ecosystems in the mesic/temperate midwest have been proposed: 
  *Moisture gradient limits tree growth
  *soil drainage can limit tree growth
  *Higher Temperatures create drought conditions
  *seasonality of temperature
  *seasonality of precipitaiton
  *slope/elevation (firebreaks and soil moisture)
  *VPD 
  
In this paper, we hypothesize that the distribution of vegetation in the past is bimodal with respect to climate, and that the commonly cited hypothesized drivers do not predict the distribution of vegetation in the past. 



##Key questions we aim to answer in this analysis:
1. Was the N.American pre-euro settlement tree cover/tree density bimodal? Is the modern landscape bimodal?
2. Does climate explain the distribution of tree density in either the past or the modern landscape?
3. Do soil factors/elevation explain tree density in either the past or the modern landscape?
4. What is the climate/soil/environmental space where the past had alternative stable density states? How bimodal is the distribution? Where is this located within the N. American Midwest?
5. Based on this climate/soil/environmental space, where should this bimodality be observed? (acknowledging that climate has changed over the last century)

We use the density data from the places where we have both Public Land Survey data (past), and Forest Inventory Analysis data (modern) across the upper midwest:

![](outputs/v1.6/tree_density_maps_PLS_FIA.png)

## Q1. Was the N.American pre-euro settlement tree cover/tree density bimodal? Is the modern landscape bimodal?

Ans. Public land survey tree density is bimodal and FIA tree density is not:

![](outputs/FIA_PLS_hists.png) 

Additionally, places that historically had low tree density in the past now have higher tree density, while those that were dense in the past have decreased in tree density:


![](outputs/v1.6/density_difference_plot.png)


## Q2. Does climate explain the distribution of tree density in either the past or the modern landscape?

The past and modern climate space of the Midwest is broad spans a large range of precipitation and temperature. 

![](outputs/v1.6/precip_vs_temp_FIA_PLS.png)

PLS & FIA tree density are not readily explained by the gradient in Precipitation, but tree denisty bimodality appears to occur between 600-900 mm/year in the past. 

![](outputs/FIA_PLS_hexbinplots.png) 

PLS & FIA density are not obviously explained as a function of mean annual temperature, but the bimodality in tree density appears to occur between 0-10 DegC in the past:

![](outputs/FIA_PLS_temp_hexbinplots.png)


##Q3. Do soil factors/elevation explain tree density in either the past or the modern landscape?

Ans. % Sand, Available Water Content (awc), and saturated hydraulic conductivity (ksat) do not explain tree density well. Additionally, doing a PCA on the environmental dataset and using PC1 and PC2 as explanatory variables do not explain tree density.


![](outputs/v1.6/sand_vs_dens_FIA_PLS.png)
![](outputs/v1.6/awc_vs_dens_FIA_PLS.png)
![](outputs/v1.6/ksat_vs_dens_FIA_PLS.png)
![](outputs/v1.6/FIA_PLS_PC1_hexbinplots.png)



## Q4. What is the environmental space where the past was bimodal? How bimodal is the distribution? Where is this located within the N. American Midwest?

Ans. We can look at bins of precipitation to get an idea of where this bimodality coefficient is likely to be highest:

![](outputs/v1.6/precipitation_by_bins_100.png)

We can look at the bins of temperature to get an idea of where the BC is likely to be highest:
![](outputs/v1.6/tmean_by_bins.png)

We can also look at the density distribution with bins of the first Principal Component of the environmental data:

![](outputs/v1.6/PC1_by_bins.png)

We can also look at the density distribution with bins of the second Principal Component of the environmental data:

![](outputs/v1.6/PC2_by_bins.png)

####To fully answer this question of how bimodal the density is, we have to define a bimodality index. There are a few options for this:
  * Dip Test (null = unimodal distribution)
  * Bimodality Coefficient calculated from size, skewness, and kurtosis of the distributions, though there may be issues with both BC and the Dip test (Pfister et al. 2013)
  * BC > 0.556 suggests bimodality
  * BC is calculated with be calculated in the R package modes
  
Bimodality coefficient is calculated from a distribuiton of data as follows:

BC = $\frac{(skew^2 + 1)}{(kurtosis + 3)*\frac{(n-1)^2}{(n-2)*(n-3)}}$

Here we calculated the BC for different bin sizes of precipitation:

Bin range of 25, non-overlapping bins:

![](outputs/v1.6/bimodality_coefficient_full_pls_25bins.png) 

Additionally, we can have overlapping bins, where each new "bin of precpitation" is offset by 10mm/year, which also present a slightly different picture.

Bin range of 25, overlapping bins:
![](outputs/v1.6/rolling_BC_plots_25.png)


We can do the same for Bins of the Principal components (this is not as easily interpretable as binning by precipitation):
![](outputs/v1.6/PC1_by_bins.png)
![](outputs/v1.6/PC2_by_bins.png)

## Where is the bimodality located within the N. American Midwest?

We can make maps of the precipitation climate space where BC > 5.5 from the BC values of non-overlapping bins of width = 75mm 

![](outputs/v1.6/PLS_FIA_precip_BC_map.png)

We can also make maps of the 1st and 2nd Principal Component Climate space where BC > 5.5 for PLS:

![](outputs/v1.6/PLS_PC1_PC2_map.png)

Maps of the 1st and 2nd Principal Component Climate space where BC > 5.5 for PLS:

![](outputs/v1.6/FIA_PC1_PC2_map.png)


## Summary:
  * PLS density is bimodal, while the modern density is not
  * We may be able to explain some of the distribution in tree density using envrionmental variables (above, and see GAM table)
  * However, none of the environmental variables here track the bimodality in the PLS data
  * We demonstrate that a large region of the midwest historically could have been either savanna or forest alternative states that are not predicted by climate.
  * Athough historically, this region supported both savanna and forest states, the modern landscape has vitually no bimodal regions. This suggests that fire suppression, land use, and environmental changes that have occurred over the last ~ 150 years may have played a role in the decline of alternative savanna & forest states in the region. 

## Questions/things to work on:
  * Are there other variables that we should include?
  * Figure predicting where the Midwest could be bimodal based on future climate
  * In terms of framing the paper, I need to discuss the regional environmental changes (fire suppresion, land use) in a way that makes it clear that these changes could have removed the endogenous vegetation feedbacks that are important for maintaining alt. stable states.
  

```{r, echo = FALSE}

#library(ggplot2)
#library(reshape2)
#library(dplyr)
#library(maps)
#library(maptools)
#library(modes)
library(stargazer)
library(mgcv)
dens.pr <- read.csv("outputs/v1.6/dens.pr.csv")



PLS.gam1 <- gam(dens.pr$PLSdensity ~ dens.pr$MAP1910 , method = "ML")
#summary(PLS.gam1) #explains 0.004% deviance


PLS.gam2 <- gam(PLSdensity ~ pasttmean , method = "ML", data = dens.pr)
#summary(PLS.gam2) #explains 15.8% deviance

PLS.gam3 <- gam(dens.pr$PLSdensity ~ dens.pr$pastdeltaP , method = "ML")
#summary(PLS.gam3) #explains 3.02% deviance

PLS.gam3 <- gam(dens.pr$PLSdensity ~ dens.pr$awc , method = "ML")
#summary(PLS.gam3) #explains 12.5% of deviance


PLS.gam4 <- gam(PLSdensity ~ pasttmean + pastdeltaP , method = "ML", data = dens.pr)
#summary(PLS.gam4) #explains 35% deviance

PLS.gam5 <- gam(dens.pr$PLSdensity ~ dens.pr$awc +dens.pr$sandpct , method = "ML")
#summary(PLS.gam5) #explains 14.9% of deviance

PLS.gam6 <- gam(dens.pr$PLSdensity ~ dens.pr$MAP1910 +dens.pr$pasttmean+ dens.pr$sandpct, method = "ML")
#summary(PLS.gam6) #explains 39% deviance

PLS.gam7 <- gam(dens.pr$PLSdensity ~ dens.pr$MAP1910 +dens.pr$pasttmean +dens.pr$awc , method = "ML")
#summary(PLS.gam7) #explains 41.3% of deviance

PLS.gam8 <- gam(dens.pr$PLSdensity ~ dens.pr$MAP1910  +dens.pr$pasttmean +dens.pr$sandpct + dens.pr$awc, method = "ML")
#summary(PLS.gam8) # explains 41% of deviance



```

## Results from Generalized additive models of PLS density with covariates:

```{r, echo = FALSE, results = 'asis'}

stargazer(PLS.gam1,PLS.gam2, PLS.gam3, PLS.gam4, PLS.gam5, PLS.gam6, PLS.gam7, PLS.gam8, type="html",
          title            = "GAM model results",dep.var.labels.include = FALSE,
          covariate.labels = c("Mean Annual Precipitation (mm)", "Mean Temperature (DegF)", "Mean Temperature (DegF)", "AWC", "Precipitaiton seasonality","% sand"),
          dep.var.caption  = "Pre-settlement tree density",
          dep.var.labels   = "Tree density (trees/ha)")


```

